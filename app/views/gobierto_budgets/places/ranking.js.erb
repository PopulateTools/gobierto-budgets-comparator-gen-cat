$('#ranking-table').replaceWith("<%= j(render partial: 'gobierto_budgets/places/ranking_table') %>")
$('.pagination').replaceWith("<%= j(paginate @ranking_items, remote: true) %>")

function updatePageUrl() {
  history.pushState({ turbolinks: {} }, '', "<%= request.url %>");
}

function updateDataEndpointPath() {
  $('[data-ranking-url]').data('ranking-url', "<%= request.path %>");
}

function updateExistingLinksWithNewFilters() {
  $('.js-ranking-link').each(function() {
    var auxLink = document.createElement("a");
    auxLink.href = this.href;

    var newParams = '<%= URI.decode({ f: params[:f] }.to_query).html_safe %>';

    this.href = auxLink.origin + auxLink.pathname + '?' + newParams;
  });
}

function updateExistingLinksWithNewVariableType() {
  $('.js-ranking-link').each(function(e) {
    var auxLink = document.createElement("a");
    auxLink.href = this.href;

    var oldVariableType = auxLink.pathname.split("/")[5];
    var newVariableType = '<%= request.path.split("/")[5] %>';

    if (oldVariableType !== newVariableType) {
      var newParams = '<%= URI.decode({ f: params[:f] }.to_query).html_safe %>';
      this.href = (auxLink.origin + auxLink.pathname).replace(oldVariableType, newVariableType) + '?' + newParams;
    }
  });
}

updatePageUrl();
updateDataEndpointPath();
updateExistingLinksWithNewFilters();
updateExistingLinksWithNewVariableType();
